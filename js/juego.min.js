var Juego={posicionVacia:{fila:2,columna:2},ganador:!1};Juego.chequearMovimientosRestantes=function(){perdiste=0,Juego.contadorDeMovimientos<=0&&($("#contadorDeMovimientos").val(perdiste),setTimeout('Juego.mostrarCartel("PERDISTE")',10))},Juego.mostrarCartel=function(e){var o=document.getElementById("segundos").innerHTML,a=document.getElementById("minutos").innerHTML,i="Â¡Armaste el Rompecabezas Correctamente! con un impresionante tiempo de "+a+":"+o,n="Intentalo nuevamente!!! Podes mejorar tu tiempo:"+a+":"+o;"GANASTE"===e?(swal({title:"FELICIDADES GANASTE",text:i,type:"success",confirmButtonColor:"#9C27B0",confirmButtonText:"Cerrar",animation:!1,customClass:"animated tada"}),Juego.reiniciarReloj(),setTimeout(function(){location.reload()},3e3)):(localStorage.setItem("swal",swal({title:"PERDISTE!!!",text:n,type:"error",confirmButtonColor:"#9C27B0",confirmButtonText:"Cerrar",showConfirmButton:!0})),setTimeout(function(){location.reload()},3e3),localStorage.getItem("swal"),Juego.reiniciarReloj())},Juego.actualizarPiezas=function(){for(y=0;y<Juego.grilla.length;y++)for(x=0;x<Juego.grilla[0].length;x++){var e=x*Juego.anchoPiezas,o=y*Juego.altoPiezas;Juego.piezas[Juego.grilla[y][x]].x=e,Juego.piezas[Juego.grilla[y][x]].y=o}},Juego.intercambiarPosiciones=function(e,o,a,i){var n=Juego.grilla[e][o];Juego.grilla[e][o]=Juego.grilla[a][i],Juego.grilla[a][i]=n,Juego.actualizarPiezas()},Juego.actualizarPosicionVacia=function(e,o){Juego.posicionVacia.fila=e,Juego.posicionVacia.columna=o},Juego.posicionValida=function(e,o){return!(e<0||e>=Juego.grilla.length||o<0||o>=Juego.grilla[0].length)&&(Juego.mezclando||Juego.setContadorDeMovimientos(Juego.contadorDeMovimientos-=1),!0)},Juego.moverEnDireccion=function(e){var o,a;Juego.contadorDeMovimientos>=0&&!Juego.ganador&&(40==e?(o=Juego.posicionVacia.fila-1,a=Juego.posicionVacia.columna):38==e?(o=Juego.posicionVacia.fila+1,a=Juego.posicionVacia.columna):39==e?(o=Juego.posicionVacia.fila,a=Juego.posicionVacia.columna-1):37==e&&(o=Juego.posicionVacia.fila,a=Juego.posicionVacia.columna+1),Juego.posicionValida(o,a)&&(Juego.intercambiarPosiciones(Juego.posicionVacia.fila,Juego.posicionVacia.columna,o,a),Juego.actualizarPosicionVacia(o,a)))},Juego.mezclarPiezas=function(e){if(e<=0)Juego.mezclando=!1;else{var o=[40,38,39,37],a=o[Math.floor(Math.random()*o.length)];Juego.moverEnDireccion(a),setTimeout(function(){Juego.mezclarPiezas(e-1)},5)}},Juego.capturarTeclas=function(){Juego.contadorDeMovimientos>=0&&!Juego.ganador&&(document.onkeydown=function(e){40!=e.which&&38!=e.which&&39!=e.which&&37!=e.which||(Juego.moverEnDireccion(e.which),Juego.chequearSiGano(),Juego.chequearMovimientosRestantes(),e.preventDefault())})},Juego.controles=function(){document.querySelector("#izquierda").addEventListener("touchstart",function(e){e.preventDefault(),Juego.moverEnDireccion(39),Juego.chequearSiGano(),Juego.chequearMovimientosRestantes()}),document.querySelector("#derecha").addEventListener("touchstart",function(e){e.preventDefault(),Juego.moverEnDireccion(37),Juego.chequearSiGano(),Juego.chequearMovimientosRestantes()}),document.querySelector("#arriba").addEventListener("touchstart",function(e){e.preventDefault(),Juego.moverEnDireccion(40),Juego.chequearSiGano(),Juego.chequearMovimientosRestantes()}),document.querySelector("#abajo").addEventListener("touchstart",function(e){e.preventDefault(),Juego.moverEnDireccion(38),Juego.chequearSiGano(),Juego.chequearMovimientosRestantes()})},Juego.capturarMouse=function(){Juego.contadorDeMovimientos>=0&&!Juego.ganador&&(document.onmousedown=function(e){var o=canvas.getBoundingClientRect();clickMouse.x=e.clientX-o.left,clickMouse.y=e.clientY-o.top;var a=Juego.piezas[0].width,i={x:Juego.piezas[Juego.piezas.length-1].x,y:Juego.piezas[Juego.piezas.length-1].y};clickMouse.x>0&&clickMouse.x<canvas.width&&clickMouse.y>0&&clickMouse.y<canvas.height&&(clickMouse.x<i.x&&clickMouse.x>i.x-a&&clickMouse.y>i.y&&clickMouse.y<i.y+a&&Juego.moverEnDireccion(39),clickMouse.x>i.x&&clickMouse.x<i.x+a&&clickMouse.y<i.y&&clickMouse.y>i.y-a&&Juego.moverEnDireccion(40),clickMouse.x>i.x+a&&clickMouse.x<i.x+2*a&&clickMouse.y>i.y&&clickMouse.y<i.y+a&&Juego.moverEnDireccion(37),clickMouse.x>i.x&&clickMouse.x<i.x+a&&clickMouse.y>i.y+a&&clickMouse.y<i.y+2*a&&Juego.moverEnDireccion(38),Juego.chequearSiGano(),Juego.chequearMovimientosRestantes())})},Juego.crearGrilla=function(){Juego.grilla=[];for(var e=0;e<Juego.cantidadDePiezasPorLado;e++){Juego.grilla[e]=new Array(Juego.cantidadDePiezasPorLado);for(var o=0;o<Juego.cantidadDePiezasPorLado;o++)Juego.grilla[e][o]=e*Juego.cantidadDePiezasPorLado+o}Juego.posicionVacia.fila=Juego.cantidadDePiezasPorLado-1,Juego.posicionVacia.columna=Juego.cantidadDePiezasPorLado-1};var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),clickMouse={x:0,y:0};Juego.cargarImagen=function(e){this.anchoPiezas=Math.floor(600/this.cantidadDePiezasPorLado),this.altoPiezas=Math.floor(600/this.cantidadDePiezasPorLado),this.anchoDeRompecabezas=this.anchoPiezas*this.cantidadDePiezasPorLado,this.altoDeRompecabezas=this.altoPiezas*this.cantidadDePiezasPorLado,this.configurarCanvas()},Juego.iniciarImagen=function(e){this.imagen=new Image;var o=this;this.imagen.addEventListener("load",function(){o.cargarImagen.call(o),e()},!1);var a=document.getElementById("canvas").style.backgroundImage;if(""==a)this.imagen.src="images/r5.jpg";else{var i=a.slice(5,-2);this.imagen.src=i}},Juego.configurarCanvas=function(){ctx.fillStyle="purple",ctx.fillRect(0,0,canvas.width,canvas.height)},Juego.construirPiezas=function(){for(Juego.piezas=new Array,y=0;y<Juego.grilla.length;y++)for(x=0;x<Juego.grilla[0].length;x++){var e=x*Juego.anchoPiezas,o=y*Juego.altoPiezas,a=e,i=o,n=new Pieza(Juego.grilla[y][x],e,o,Juego.anchoPiezas,Juego.altoPiezas);n.setImageURL(this.imagen.src),n.setImageCrop(a,i),Juego.piezas.push(n)}},Juego.iniciar=function(e){this.movimientosTotales=e,Juego.contadorDeMovimientos=e,Juego.maxMovimientos=0,Juego.mezclando=!0,Juego.frameCount=0,Juego.opacidadObraFinal=.5,this.piezas=[],this.grilla=[];var o=$("input[type='radio'][name='nivel']:checked").val();Juego.configurarNivel(o),$("#cantidadPiezasPorLado").val(Juego.cantidadDePiezasPorLado),$("#btnReIniciar").click(function(){location.reload()}),$("#btnMezclar").click(function(){Juego.mezclando=!0,Juego.mezclarPiezas(20)}),$("#btnInicio").val(1),$("#btnInicio").delay(200).animate({value:"0"},2500);var a=this;this.crearGrilla(),this.filaPosicionVacia=this.cantidadDePiezasPorLado-1,this.columnaPosicionVacia=this.cantidadDePiezasPorLado-1,this.iniciarImagen(function(){a.construirPiezas();var e=Math.max(Math.pow(a.cantidadDePiezasPorLado,3),100);Juego.capturarTeclas(),Juego.capturarMouse(),a.mezclarPiezas(e),Juego.iniciarReloj(),Juego.controles(),setInterval(function(){ctx.clearRect(0,0,canvas.width,canvas.height),Juego.frameCount+=1,Juego.piezas.forEach(function(e){ctx.strokeStyle="purple",ctx.drawImage(e.image,e.xCrop,e.yCrop,e.width,e.height,e.x,e.y,e.width,e.height),ctx.strokeRect(e.xCrop,e.yCrop,e.width,e.width)}),Juego.mostrarPiezaMovil(),ctx.save(),ctx.globalAlpha=$("#btnInicio").val(),ctx.drawImage(Juego.piezas[0].image,0,0),ctx.restore()},1e3/30)})},Juego.setContadorDeMovimientos=function(e){Juego.contadorDeMovimientos=e,Juego.mezclando?$("#contadorDeMovimientos").val(0):$("#contadorDeMovimientos").val(Juego.contadorDeMovimientos)},Juego.configurarNivel=function(e){var o=0,a=0;"facil"==(e=void 0==e?"facil":e)?(o=3,a=30):"medio"==e?(o=4,a=50):"dificil"==e?(o=5,a=70):(o=Math.abs($("#cantidadPiezasPorLado").val()),a=Math.abs($("#contadorDeMovimientos").val())),Juego.cantidadDePiezasPorLado=o,Juego.maxMovimientos=a,Juego.contadorDeMovimientos=Juego.maxMovimientos,$("#contadorDeMovimientos").val(Juego.maxMovimientos)},Juego.mostrarPiezaMovil=function(){ctx.fillStyle="rgba(156, 39, 176)",ctx.fillRect(Juego.piezas[Juego.piezas.length-1].x,Juego.piezas[Juego.piezas.length-1].y,Juego.piezas[0].width,Juego.piezas[0].height)};var seg,min,reloj;Juego.reiniciarReloj=function(){clearInterval(reloj)},Juego.iniciarReloj=function(){seg=0,min=0,s=document.getElementById("segundos"),m=document.getElementById("minutos"),reloj=setInterval(function(){60==seg&&(seg=0,min++,m.innerHTML=min<10?"0"+min:min,60==min&&(min=0)),s.innerHTML=seg<10?"0"+seg:seg,seg++},1e3)},Juego.chequearSiGano=function(){if(Juego.ganador=!0,Juego.contadorDeMovimientos>=0){for(var e=0;e<Juego.grilla.length;e++)for(var o=0;o<Juego.grilla[e].length;o++){var a=Juego.grilla[0].length*e+o;Juego.grilla[e][o]!=a&&(Juego.ganador=!1)}Juego.ganador&&setTimeout("Juego.mostrarCartel('GANASTE')",10)}};